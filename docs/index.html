<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.0">
<title>ds API documentation</title>
<meta name="description" content="Run dev scripts ‚Ä¶">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Package <code>ds</code></h1>
</header>
<section id="section-intro">
<p>Run dev scripts.</p>
<!--
[[[cog from cog_helpers import * ]]]
[[[end]]]
-->
<p align="center">
<a href="https://github.com/metaist/ds/actions/workflows/ci.yaml"><img alt="Build" src="https://img.shields.io/github/actions/workflow/status/metaist/ds/.github/workflows/ci.yaml?branch=main&logo=github"/></a>
<a href="https://pypi.org/project/ds-run"><img alt="PyPI" src="https://img.shields.io/pypi/v/ds-run.svg?color=blue" /></a>
<a href="https://pypi.org/project/ds-run"><img alt="Supported Python Versions" src="https://img.shields.io/pypi/pyversions/ds-run" /></a>
</p>
<p>Dev scripts are the short names we give to common tasks and long commands in a software project. <code><a title="ds" href="#ds">ds</a></code> finds and runs dev scripts in your project's configuration file (e.g., <code>Cargo.toml</code>, <code>package.json</code>, <code>pyproject.toml</code>, etc.):</p>
<pre><code class="language-bash">pip install ds-run  # or: uv tool install ds-run
ds --list           # list the tasks
ds clean lint test  # run multiple tasks
ds format:*         # run tasks that match a glob
ds test -vv         # pass arguments to tasks
ds -e PORT=8080 run # set environment variables
ds +cspell test     # suppress errors
ds -w* build        # supports monorepo/workspaces
</code></pre>
<p>Read more:</p>
<ul>
<li><a href="#install">Installing <code>ds</code></a></li>
<li><a href="https://github.com/metaist/ds/tree/main/examples/formats">Example configuration files</a></li>
<li><a href="#when-should-i-make-a-dev-script">When should I make a dev script?</a></li>
<li><a href="#where-should-i-put-my-config">Where should I put my config?</a></li>
<li><a href="#how-does-ds-find-my-config">How does <code>ds</code> find my config?</a></li>
<li><a href="#where-do-tasks-run">Where do tasks run?</a></li>
</ul>
<h2 id="example">Example</h2>
<p>Suppose you want to use <code>pytest</code> with <code>coverage</code> to run unit tests, doctests, and to generate a branch-level coverage report:</p>
<pre><code class="language-bash">coverage run --branch --source=src -m \
  pytest \
    --doctest-modules \
    --doctest-ignore-import-errors \
    src test;
coverage report -m
</code></pre>
<p>Instead of typing that, we just add a script to our <code>pyproject.toml</code> file:</p>
<pre><code class="language-toml">[tool.ds.scripts]
test = &quot;&quot;&quot;
  coverage run --branch --source=src -m \
    pytest \
      --doctest-modules \
      --doctest-ignore-import-errors \
      src test;
  coverage report -m
&quot;&quot;&quot;
</code></pre>
<p>And now you can run it with a quick shorthand:</p>
<pre><code class="language-bash">ds test
</code></pre>
<h2 id="benefits">Benefits</h2>
<p>‚ôªÔ∏è <strong>Works with existing projects</strong><br />
<a href="#limitations">Almost</a> a drop-in replacement for:</p>
<ul>
<li><strong>Node</strong> (<code>package.json</code>): <a href="https://docs.npmjs.com/cli/v10/commands/npm-run-script"><code>npm run</code></a>, <a href="https://yarnpkg.com/cli/run"><code>yarn run</code></a>, <a href="https://pnpm.io/cli/run"><code>pnpm run</code></a>, <a href="https://bun.sh/docs/cli/run"><code>bun run</code></a></li>
<li><strong>Python</strong> (<code>pyproject.toml</code>): <a href="https://pdm-project.org/latest/usage/scripts/#user-scripts"><code>pdm run</code></a>, <a href="https://rye.astral.sh/guide/commands/run/"><code>rye run</code></a></li>
<li><strong>PHP</strong> (<code>composer.json</code>): <a href="https://getcomposer.org/doc/articles/scripts.md#running-scripts-manually"><code>composer run-script</code></a></li>
<li><strong>Rust</strong> (<code>Cargo.toml</code>): <a href="https://github.com/JoshMcguigan/cargo-run-script/"><code>cargo run-script</code></a></li>
</ul>
<p><strong>Experimental</strong>: We also support an extremely small subset of the <a href="https://github.com/metaist/ds/issues/68"><code>Makefile</code></a> format (see <a href="https://github.com/metaist/ds/issues/68">#68</a>).</p>
<p>See: <a href="#inspirations">Inspirations</a></p>
<p>üóÇÔ∏è <strong>Add monorepo/workspace support anywhere</strong><br />
Easily <a href="#workspaces">manage monorepos and sub-projects</a>, even if they use different tooling.</p>
<p>üèÉ <strong>Run multiple tasks with custom arguments for each task</strong><br />
Provide <a href="#command-line-arguments">command-line arguments</a> for multiple tasks as well as simple <a href="#argument-interpolation">argument interpolation</a>.</p>
<p>ü™Ñ <strong>Minimal magic</strong><br/>
Tries to use familiar syntax and a few clear rules. Checks for basic cycles and raises helpful error messages if things go wrong.</p>
<p>üöÄ <strong>Minimal dependencies</strong><br />
Currently working on removing all of these (see <a href="https://github.com/metaist/ds/issues/46">#46</a>):</p>
<ul>
<li>python (3.8+)</li>
<li><code>tomli</code> (for python &lt; 3.11)</li>
<li><code>graphlib_backport</code> (for python &lt; 3.9)</li>
</ul>
<h2 id="limitations">Limitations</h2>
<p><code><a title="ds" href="#ds">ds</a></code> <strong>does not</strong> strive to be an all-in-one tool for every project and is not a replacement for package management tools or <code>make</code>. Here are some things that are not supported or not yet implemented.</p>
<ul>
<li>Not Supported: <a href="#not-supported-lifecycle-events">Lifecycle Events</a></li>
<li>Not Supported: <a href="#not-supported-call-tasks"><code>call</code> Tasks</a></li>
<li>Partial Support: <a href="https://github.com/metaist/ds/issues/68"><code>Makefile</code> format</a> (see <a href="https://github.com/metaist/ds/issues/68">#68</a>)</li>
<li>In Progress: <a href="https://github.com/metaist/ds/issues/44">Shell Completions</a> (see <a href="https://github.com/metaist/ds/issues/44">#44</a>)</li>
<li>In Progress: <a href="https://github.com/metaist/ds/issues/46">Remove Python Dependency</a> (see <a href="https://github.com/metaist/ds/issues/46">#46</a>)</li>
</ul>
<h2 id="install">Install</h2>
<p><code><a title="ds" href="#ds">ds</a></code> is typically installed at the system-level to make it available across all your projects.</p>
<pre><code class="language-bash">python -m pip install ds-run

# or, if you use uv:
uv tool install ds-run
</code></pre>
<p>You can also <a href="https://github.com/metaist/ds/releases/latest/download/ds">download a Cosmopolitan binary</a> which runs on Windows, macOS, and Linux:</p>
<pre><code class="language-bash">export LOCAL_BIN=$HOME/.local/bin # or anywhere on your PATH
mkdir -p $LOCAL_BIN
wget -O $LOCAL_BIN/ds -N https://github.com/metaist/ds/releases/latest/download/ds
chmod +x $LOCAL_BIN/ds
ds --version
# NOTE: it takes a few seconds the first time you run it
</code></pre>
<p>If you just want to try <code><a title="ds" href="#ds">ds</a></code>:</p>
<pre><code class="language-bash">uvx --from ds-run ds --version
# or
pipx run ds-run --version
</code></pre>
<h2 id="usage">Usage</h2>
<!--[[[cog fenced_block(snip_file("src/ds/args.py", beg="Usage:", end="Examples:")) ]]]-->
<pre><code class="language-text">Usage: ds [--help | --version] [--debug]
          [--dry-run]
          [--no-config]
          [--no-project]
          [--list]
          [--cwd PATH]
          [--file PATH]
          [--env-file PATH]
          [(--env NAME=VALUE)...]
          [--workspace GLOB]...
          [--pre][--post]
          [&lt;task&gt;...]

Options:
  -h, --help
    Show this message and exit.

  --version
    Show program version and exit.

  --debug
    Show debug messages.

  --cwd PATH
    Set the starting working directory (default: --file parent).
    PATH is resolved relative to the current working directory.

  --dry-run
    Show which tasks would be run, but don't actually run them.

  --env-file PATH
    File with environment variables. This file is read before --env
    values are applied.

  -e NAME=VALUE, --env NAME=VALUE
    Set one or more environment variables. Supersedes any values set in
    an `--env-file`.

  -f PATH, --file PATH
    File with task and workspace definitions (default: search in parents).

    Read more about the configuration file:
    https://github.com/metaist/ds

  -l, --list
    List available tasks and exit.

  --no-config
    Do not search for or load a configuration file. Supersedes `--file`.

  --no-project
    Do not search for project dependencies, e.g., `.venv`, `node_modules`

  -w GLOB, --workspace GLOB
    Patterns which indicate in which workspaces to run tasks.

    GLOB filters the list of workspaces defined in `--file`.
    The special pattern '*' matches all of the workspaces.

    Read more about configuring workspaces:
    https://github.com/metaist/ds#workspaces

  --pre, --post
    EXPERIMENTAL: Run tasks with pre- and post- names.

  &lt;task&gt;
    One or more tasks to run with task-specific arguments.

    The simplest way to pass arguments to tasks is to put them in quotes:

    $ ds 'echo &quot;Hello world&quot;'

    For more complex cases you can use a colon (`:`) to indicate start of arguments and double-dash (`--`) to indicate the end:

    $ ds echo: &quot;Hello from&quot; -- echo: &quot;the world&quot;

    If the first &lt;option&gt; starts with a hyphen (`-`), you may omit the
    colon (`:`). If there are no more tasks after the last option, you
    may omit the double-dash (`--`).

    Tasks are executed in order across any relevant workspaces. If any
    task returns a non-zero code, task execution stops unless the
    &lt;task&gt; was prefixed with a (`+`) in which case execution continues.

    Read more about error suppression:
    https://github.com/metaist/ds#error-suppression

</code></pre>
<!--[[[end]]]-->
<h2 id="when-should-i-make-a-dev-script">When should I make a dev script?</h2>
<p>Typically, you should make a dev script for important steps in your development process. For example, most projects will need a way to run linters and unit tests (see the <a href="#example"><code>test</code> example above</a>). Some projects also need a way to start up a server, fetch configuration files, or clean up generated files.</p>
<p>Dev scripts act as another form of documentation that helps developers understand how to build and work on your project.</p>
<h2 id="where-should-i-put-my-config">Where should I put my config?</h2>
<p><code><a title="ds" href="#ds">ds</a></code> supports <code>.json</code> and <code>.toml</code> configuration files (see <a href="https://github.com/metaist/ds/tree/main/examples/formats">examples</a>) which typically go in the top-level of your project. To avoid making lots of top-level files, <code><a title="ds" href="#ds">ds</a></code> can use common project configuration files.</p>
<ul>
<li><strong>Node</strong>: <code>package.json</code> under <code>scripts</code></li>
<li><strong>PHP</strong>: <code>composer.json</code> under <code>scripts</code></li>
<li><strong>Python</strong>: <code>pyproject.toml</code> under <code>[tool.ds.scripts]</code> (<code>[tool.pdm.scripts]</code> and <code>[tool.rye.scripts]</code> also supported)</li>
<li><strong>Rust</strong>: <code>Cargo.toml</code> under <code>[package.metadata.scripts]</code> or <code>[workspace.metadata.scripts]</code></li>
<li><strong>Other</strong>: <code>ds.toml</code> under <code>[scripts]</code></li>
</ul>
<p><strong>Experimental</strong>: We support an extremely small subset of the <a href="https://github.com/metaist/ds/issues/68"><code>Makefile</code></a> format (see <a href="https://github.com/metaist/ds/issues/68">#68</a>).</p>
<p>Read more:</p>
<ul>
<li><a href="https://github.com/metaist/ds/tree/main/examples/formats">Example configuration files</a></li>
<li><a href="#workspaces">Workspaces</a></li>
</ul>
<h2 id="how-does-ds-find-my-config">How does <code><a title="ds" href="#ds">ds</a></code> find my config?</h2>
<p>If you don't provide a config file using the <code>--file</code> option, <code><a title="ds" href="#ds">ds</a></code> will search the current directory and all of its parents for files with these name patterns in the following order:</p>
<!--[[[cog
from ds.parsers import PARSERS
cog.outl()
for key in list(PARSERS):
cog.outl(f"- `{key}`")
cog.outl()
]]] -->
<ul>
<li><code>ds.toml</code></li>
<li><code>pyproject.toml</code></li>
<li><code>uv.toml</code></li>
<li><code>package.json</code></li>
<li><code>Cargo.toml</code></li>
<li><code>composer.json</code></li>
<li><code>[Mm]akefile</code></li>
</ul>
<!--[[[end]]]-->
<p>If you provide one or more <code>--workspace</code> options, the file must contain a <a href="#workspaces">workspace key</a>. Otherwise, then the file must contain a <a href="#task-keys">task key</a>.</p>
<p>If the appropriate key cannot be found, searching continues up the directory tree. The first file that has the appropriate key is used.</p>
<p>One exception to the search process is when using the <code>--workspace</code> option: If a workspace member contains a file with the same name as the configuration file, that file is used <em>within</em> the workspace (e.g., a workspace defined in <code>Cargo.toml</code> will try to find a <code>Cargo.toml</code> in each workspace). Otherwise, the usual search process is used.</p>
<h2 id="where-do-tasks-run">Where do tasks run?</h2>
<p>Typically, tasks run in the same directory as the configuration file.</p>
<p>If you provide a <code>--cwd</code> option (but not a <code>--workspace</code> option), tasks will run in the directory provided by the <code>--cwd</code> option.</p>
<p>If you provide one or more <code>--workspace</code> options, <code>--cwd</code> is ignored and tasks are run in each of the selected workspace members.</p>
<p><strong>NOTE</strong>: In configuration files, you can use the <code>cwd</code> or <code>working_dir</code> option to specify a working directory for a <em>specific</em> task and that option will be respected even when using <code>--workspace</code> or <code>--cwd</code> from the command line.</p>
<h2 id="task-keys">Task Keys</h2>
<p><code><a title="ds" href="#ds">ds</a></code> searches configuration files for <a href="https://github.com/metaist/ds/tree/main/examples/formats">tool-specific keys</a> to find task definitions which should contain a mapping from <a href="#task-names">task names</a> to <a href="#basic-task">basic tasks</a> or <a href="#composite-task">composite tasks</a>.</p>
<h2 id="task-names">Task Names</h2>
<ul>
<li>Task names are strings, that are usually short, lowercase, ASCII letters.</li>
<li>They can have a colon (<code>:</code>) in them, like <code>py:build</code>.</li>
<li>All leading and trailing whitespace in a task name is trimmed.</li>
<li>If the name is empty or starts with a hash (<code>#</code>) it is ignored. This allows formats like <code>package.json</code> to "comment out" tasks.</li>
<li>Don't start a name with a plus (<code>+</code>) because that indicates <a href="#error-suppression">error suppression</a>.</li>
<li>Don't start a name with a hyphen (<code>-</code>) because that can make the task look like a <a href="#command-line-arguments">command-line argument</a>.</li>
<li>Don't end a task name with a colon (<code>:</code>) because we use that to pass <a href="#command-line-arguments">command-line arguments</a></li>
</ul>
<h2 id="basic-task">Basic Task</h2>
<p>A basic task is just a string of what should be executed in a shell using <code>subprocess.run</code>.</p>
<ul>
<li>Supports most <a href="https://pdm-project.org"><code>pdm</code>-style</a> and <a href="https://rye.astral.sh"><code>rye</code>-style</a> commands (<a href="#not-supported-call-tasks">except <code>call</code></a>)</li>
<li>Supports <a href="#argument-interpolation">argument interpolation</a></li>
<li>Supports <a href="#error-suppression">error suppression</a></li>
</ul>
<!--[[[cog insert_file("examples/readme/basic.toml")]]]-->
<pre><code class="language-toml"># Example: Basic tasks become strings.

[scripts]
ls = &quot;ls -lah&quot;
no_error = &quot;+exit 1&quot; # See &quot;Error Suppression&quot;

# We also support `pdm`-style and `rye`-style commands.
# The following are all equivalent to `ls` above.
ls2 = { cmd = &quot;ls -lah&quot; }
ls3 = { cmd = [&quot;ls&quot;, &quot;-lah&quot;] }
ls4 = { shell = &quot;ls -lah&quot; }
</code></pre>
<!--[[[end]]]-->
<h2 id="composite-task">Composite Task</h2>
<p>A composite task consists of a series of steps where each step is the name of another task or a shell command.</p>
<ul>
<li>Supports <a href="https://pdm-project.org"><code>pdm</code>-style</a> <code>composite</code> and <a href="https://rye.astral.sh"><code>rye</code>-style</a> <code>chain</code></li>
<li>Supports <a href="#argument-interpolation">argument interpolation</a></li>
<li>Supports <a href="#error-suppression">error suppression</a></li>
</ul>
<!--[[[cog insert_file("examples/readme/composite.toml")]]]-->
<pre><code class="language-toml"># Example: Composite tasks call other tasks or shell commands.

[scripts]
build = &quot;touch build/$1&quot;
clean = &quot;rm -rf build&quot;

# We also support `pdm`-style and `rye`-style composite commands.
# The following are all equivalent.
all = [&quot;clean&quot;, &quot;+mkdir build&quot;, &quot;build foo&quot;, &quot;build bar&quot;, &quot;echo 'Done'&quot;]

pdm-style = { composite = [
  &quot;clean&quot;,
  &quot;+mkdir build&quot;, # See: Error Suppression
  &quot;build foo&quot;,
  &quot;build bar&quot;,
  &quot;echo 'Done'&quot;, # Composite tasks can call shell commands.
] }

rye-style = { chain = [
  &quot;clean&quot;,
  &quot;+mkdir build&quot;, # See: Error Suppression
  &quot;build foo&quot;,
  &quot;build bar&quot;,
  &quot;echo 'Done'&quot;, # Composite tasks can call shell commands.
] }
</code></pre>
<!--[[[end]]]-->
<h2 id="argument-interpolation">Argument Interpolation</h2>
<p>Tasks can include parameters like <code>$1</code> and <code>$2</code> to indicate that the task accepts arguments.</p>
<p>You can also use <code>$@</code> for the "remaining" arguments (i.e. those you haven't yet interpolated yet).</p>
<p>You can also specify a default value for any argument using a <code>bash</code>-like syntax: <code>${1:-default value}</code>.</p>
<p>Arguments from a <a href="#composite-task">composite task</a> precede those <a href="#command-line-arguments">from the command-line</a>.</p>
<!--[[[cog insert_file("examples/readme/argument-interpolation.toml")]]]-->
<pre><code class="language-toml"># Example: Argument interpolation lets you pass arguments to tasks.

[scripts]
# pass arguments, but supply defaults
test = &quot;pytest ${@:-src test}&quot;

# interpolate the first argument (required)
# and then interpolate the remaining arguments, if any
lint = &quot;ruff check $1 ${@:-}&quot;

# we also support the pdm-style {args} placeholder
test2 = &quot;pytest {args:src test}&quot;
lint2 = &quot;ruff check {args}&quot;

# pass an argument and re-use it
release = &quot;&quot;&quot;\
  git commit -am &quot;release: $1&quot;;\
  git tag $1;\
  git push;\
  git push --tags;\
  git checkout main;\
  git merge --no-ff --no-edit prod;\
  git push
&quot;&quot;&quot;
</code></pre>
<!--[[[end]]]-->
<h3 id="command-line-arguments">Command-line Arguments</h3>
<p>When calling <code><a title="ds" href="#ds">ds</a></code> you can specify additional arguments to pass to commands.</p>
<pre><code class="language-bash">ds build: foo -- build: bar
</code></pre>
<p>This would run the <code>build</code> task first with the argument <code>foo</code> and next with the argument <code>bar</code>.</p>
<p>A few things to note:</p>
<ul>
<li>the colon (<code>:</code>) after the task name indicates the start of arguments</li>
<li>the double dash (<code>--</code>) indicates the end of arguments</li>
</ul>
<p>If the first argument to the task starts with a hyphen, the colon can be omitted.
If there are no more arguments, you can omit the double dash.</p>
<pre><code class="language-bash">ds test -v
</code></pre>
<p>If you're not passing arguments, you can put tasks names next to each other:</p>
<pre><code class="language-bash">ds clean test
</code></pre>
<h2 id="error-suppression">Error Suppression</h2>
<p>If a task starts with a plus sign (<code>+</code>), the plus sign is removed before the command is executed and the command will always produce an return code of <code>0</code> (i.e. it will always be considered to have completed successfully).</p>
<p>This is particularly useful in <a href="#composite-command">composite commands</a> where you want subsequent steps to continue even if a particular step fails. For example:</p>
<!--[[[cog insert_file("examples/readme/error-suppression.toml")]]]-->
<pre><code class="language-toml"># Example: Error suppression lets subsequent tasks continue after failure.

[scripts]
cspell = &quot;cspell --gitignore '**/*.{py,txt,md,markdown}'&quot;
format = &quot;ruff format .&quot;
die = &quot;+exit 1&quot; # returns error code of 0
die_hard = &quot;exit 2&quot; # returns an error code of 2 unless suppressed elsewhere
lint = [&quot;+cspell&quot;, &quot;format&quot;] # format runs even if cspell finds misspellings
</code></pre>
<!--[[[end]]]-->
<p>Error suppression works both in configuration files and on the command-line:</p>
<pre><code class="language-bash">ds die_hard format
# =&gt; error after `die_hard`

ds +die_hard format
# =&gt; no error
</code></pre>
<h2 id="environment-variables">Environment Variables</h2>
<p>You can set environment variables on a per-task basis:</p>
<!--[[[cog insert_file("examples/readme/environment-variables.toml")]]]-->
<pre><code class="language-toml"># Example: Environment variables can be set on tasks.

[scripts]
# set an environment variable
run = { cmd = &quot;python -m src.server&quot;, env = { FLASK_PORT = &quot;8080&quot; } }

# use a file relative to the configuration file
run2 = { cmd = &quot;python -m src.server&quot;, env-file = &quot;.env&quot; }

# composite tasks override environment variables
run3 = { composite = [&quot;run&quot;], env = { FLASK_PORT = &quot;8081&quot; } }
</code></pre>
<!--[[[end]]]-->
<p>You can also set environment variables on the command-line, but the apply to <em>all</em> of the tasks:</p>
<pre><code class="language-bash">ds -e FLASK_PORT=8080 run
ds --env-file .env run
</code></pre>
<h2 id="workspaces">Workspaces</h2>
<p>Workspaces are a way of managing multiple sub-projects from a top-level. <code><a title="ds" href="#ds">ds</a></code> supports <code>npm</code>, <code>rye</code>, <code>uv</code>, and <code>Cargo</code> style workspaces.</p>
<p>When <code><a title="ds" href="#ds">ds</a></code> is called with the <code>--workspace</code> option, the configuration file must have one of the <a href="https://github.com/metaist/ds/tree/main/examples/workspace">tool-specific workspace keys</a>.</p>
<p>If no configuration file was provided with the <code>--file</code> option, search continues up the directory tree.</p>
<p><strong>NOTE</strong>: <code>pnpm</code> has its own <a href="https://pnpm.io/pnpm-workspace_yaml"><code>pnpm-workspace.yaml</code></a> format which is not currently supported.</p>
<h3 id="workspace-members">Workspace Members</h3>
<p>The value corresponding to the workspace key should be a list of patterns that indicate which directories (relative to the configuration file) should be included as members. The following <code>glob</code>-like patterns are supported:</p>
<ul>
<li><code>?</code>: matches a single character (e.g., <code>ca?</code> matches <code>car</code>, <code>cab</code>, and <code>cat</code>)</li>
<li><code>[]</code>: matches specific characters (e.g., <code>ca[rb]</code> matches <code>car</code> and <code>cab</code>)</li>
<li><code>*</code>: matches multiple characters, but not <code>/</code> (e.g., <code>members/*</code> matches all the files in <code>members</code>, but not further down the tree)</li>
<li><code>**</code>: matches multiple characters, including <code>/</code> (e.g., <code>members/**</code> matches all files in <code>members</code> and all sub-directories and all of their contents)</li>
</ul>
<p>If you prefix any pattern with an exclamation point (<code>!</code>) then the rest of the pattern describes which files should <em>not</em> be matched.</p>
<p>Patterns are applied in order so subsequent patterns can include or exclude sub-directories as needed. <a href="https://github.com/metaist/ds/tree/main/examples/workspace/Cargo.toml">We also support the <code>excludes</code> key</a> (for <code>uv</code> and <code>Cargo</code>) which is applied <em>after</em> all the members.</p>
<!--[[[cog insert_file("examples/workspace/ds.toml")]]]-->
<pre><code class="language-toml"># Example: workspace includes everything in `members` except `members/x`.

[workspace]
members = [&quot;members/*&quot;, &quot;!members/x&quot;]
</code></pre>
<!--[[[end]]]-->
<h3 id="workspace-tasks">Workspace Tasks</h3>
<p>To run a task across multiple workspaces, use the <code>--workspace</code> or <code>-w</code> options one or more times with a pattern that indicates where the tasks should run.</p>
<p>For example, consider a workspace with directories <code>members/a</code>, <code>members/b</code>, and <code>members/x</code>. The configuration above would match the first two directories and exclude the third.</p>
<p>The following are all equivalent and run <code>test</code> in both <code>member/a</code> and <code>member/b</code>:</p>
<pre><code class="language-bash">ds --workspace '*' test   # special match that means &quot;all workspaces&quot;
ds -w '*' test            # short option
ds -w* test               # even shorter option
ds -w '*/a' -w '*/b' test # manually select multiple workspaces
</code></pre>
<h2 id="not-supported-lifecycle-events">Not Supported: Lifecycle Events</h2>
<p>Some task runners (all the <code>node</code> ones, <code>pdm</code>, <code>composer</code>) support running additional pre- and post- tasks when you run a task. However, this obscures the relationship between tasks and can create surprises if you happen to have two tasks with unfortunate names (e.g., <code>pend</code> and <code>prepend</code>). <code><a title="ds" href="#ds">ds</a></code> does not plan to support this behavior (see <a href="https://github.com/metaist/ds/issues/24">#24</a>).</p>
<p>As more explicit alternative is to use <a href="#composite-command">composite commands</a> to clearly describe the relationship between a task and its pre- and post- tasks.</p>
<!--[[[cog insert_file("examples/readme/lifecycle-bad.toml")]]]-->
<pre><code class="language-toml"># Bad example: hidden assumption that `build` calls `prebuild` first.
[scripts]
prebuild = &quot;echo 'prebuild'&quot;
build = &quot;echo 'build'&quot;
</code></pre>
<!--[[[end]]]-->
<!--[[[cog insert_file("examples/readme/lifecycle-good.toml")]]]-->
<pre><code class="language-toml"># Good example: clear relationship between tasks.
[scripts]
prebuild = &quot;echo 'prebuild'&quot;
build = [&quot;prebuild&quot;, &quot;echo 'build'&quot;]
</code></pre>
<!--[[[end]]]-->
<h2 id="not-supported-call-tasks">Not Supported: <code>call</code> Tasks</h2>
<p>Some task runners support special <code>call</code> tasks which get converted into language-specific calls. For example, both <code>pdm</code> and <code>rye</code> can <code>call</code> into python packages and <code>composer</code> can <code>call</code> into a PHP module call.</p>
<p>These types of tasks introduces a significant difference between what you write in the configuration file and what gets executed, so in the interest of reducing magic, <code><a title="ds" href="#ds">ds</a></code> does not currently support this behavior (see <a href="https://github.com/metaist/ds/issues/32">#32</a>).</p>
<p>A more explicit alternative is to write out the call you intend:</p>
<pre><code class="language-bash"># {&quot;call&quot;: &quot;pkg&quot;} becomes:
python -m pkg

# {&quot;call&quot;: &quot;pkg:main('test')&quot;} becomes:
python -c &quot;import sys; from pkg import main as _1; sys.exit(main('test'))&quot;
</code></pre>
<h2 id="inspirations">Inspirations</h2>
<p>I've used several task runners, usually as part of build tools. Below is a list of tools used or read about when building <code><a title="ds" href="#ds">ds</a></code>.</p>
<ul>
<li>
<p>1976: <a href="https://en.wikipedia.org/wiki/Make_(software)"><code>make</code></a> (C) - Together with its descendants, <code>make</code> is one of the most popular build &amp; task running tools. It is fairly easy to make syntax errors and the tab-based indent drives me up the wall.</p>
</li>
<li>
<p>2000: <a href="https://en.wikipedia.org/wiki/Apache_Ant"><code>ant</code></a> (Java) - an XML-based replacement for <code>make</code>. I actually liked using <code>ant</code> quite a bit until I stopped writing Java and didn't want to have <code>java</code> as a dependency for my <code>python</code> projects.</p>
</li>
<li>
<p>2008: <a href="https://en.wikipedia.org/wiki/Gradle"><code>gradle</code></a> (Groovy/Kotlin) - Written for the <code>jvm</code>, I pretty much only use this for Android development. Can't say I love it.</p>
</li>
<li>
<p>2010: <a href="https://en.wikipedia.org/wiki/Npm"><code>npm</code></a> (JavaScript) - Being able to add a simple <code>scripts</code> field to <code>package.json</code> made it very easy to run dev scripts. Supports <code>pre</code> and <code>post</code> lifecycle tasks.</p>
</li>
<li>
<p>2010: <a href="https://pdm-project.org"><code>pdm</code></a> (Python) - Supports 4 different types of tasks including <code>cmd</code>, <code>shell</code>, <code>call</code>, and <code>composite</code>.</p>
</li>
<li>
<p>2012: <a href="https://getcomposer.org"><code>composer</code></a> (PHP) - Uses <code>composer.json</code>, similar to <code>package.json</code>. Supports pre- and post- task lifecycle for special tasks, command-line arguments, composite tasks, and other options.</p>
</li>
<li>
<p>2016: <a href="https://yarnpkg.com"><code>yarn</code></a> (JavaScript) - An alternative to <code>npm</code> which also supports command-line arguments.</p>
</li>
<li>
<p>2016: <a href="https://pnpm.io"><code>pnpm</code></a> (JavaScript) - Another alternative to <code>npm</code> which supports many more options including running tasks in parallel.</p>
</li>
<li>
<p>2016: <a href="https://github.com/casey/just"><code>just</code></a> (Rust) - Defines tasks in a <code>justfile</code>, similar to <code>make</code>. Supports detecting cycles, running parallel, and many other options.</p>
</li>
<li>
<p>2016: <a href="https://github.com/JoshMcguigan/cargo-run-script/"><code>cargo-run-script</code></a> (Rust) - Uses <code>Cargo.toml</code> to configure scripts and supports argument substitution (<code>$1</code>, <code>$2</code>, etc.).</p>
</li>
<li>
<p>2017: <a href="https://github.com/sagiegurari/cargo-make"><code>cargo-make</code></a> (Rust) - Very extensive port of <code>make</code> to Rust defining tasks in <code>Makefile.toml</code>.</p>
</li>
<li>
<p>2022: <a href="https://hatch.pypa.io/1.12/config/environment/overview/#scripts"><code>hatch</code></a> (Python) - Defines environment-specific scripts with the ability to suppress errors, like <code>make</code>.</p>
</li>
<li>
<p>2023: <a href="https://en.wikipedia.org/wiki/Bun_(software)"><code>bun</code></a> (Zig) - An alternative to <code>node</code> and <code>npm</code>.</p>
</li>
<li>
<p>2023: <a href="https://rye.astral.sh"><code>rye</code></a> (Rust) - Up-and-coming replacement for managing python projects.</p>
</li>
</ul>
<h2 id="license">License</h2>
<p><a href="https://github.com/metaist/ds/blob/main/LICENSE.md">MIT License</a></p>
</section>
<section>
<h2 class="section-title" id="header-submodules">Sub-modules</h2>
<dl>
<dt><code class="name"><a title="ds.args" href="args.html">ds.args</a></code></dt>
<dd>
<div class="desc"><p>Parse command-line arguments.</p></div>
</dd>
<dt><code class="name"><a title="ds.configs" href="configs.html">ds.configs</a></code></dt>
<dd>
<div class="desc"><p>Configs are a path and data.</p></div>
</dd>
<dt><code class="name"><a title="ds.env" href="env.html">ds.env</a></code></dt>
<dd>
<div class="desc"><p>Shell environment variables.</p></div>
</dd>
<dt><code class="name"><a title="ds.parsers" href="parsers/index.html">ds.parsers</a></code></dt>
<dd>
<div class="desc"><p>Parsers for supported formats.</p></div>
</dd>
<dt><code class="name"><a title="ds.runner" href="runner.html">ds.runner</a></code></dt>
<dd>
<div class="desc"><p>Run tasks.</p></div>
</dd>
<dt><code class="name"><a title="ds.searchers" href="searchers.html">ds.searchers</a></code></dt>
<dd>
<div class="desc"><p>Find keys, names, directories and files.</p></div>
</dd>
<dt><code class="name"><a title="ds.symbols" href="symbols.html">ds.symbols</a></code></dt>
<dd>
<div class="desc"><p>Special symbols and their meanings.</p></div>
</dd>
<dt><code class="name"><a title="ds.tasks" href="tasks.html">ds.tasks</a></code></dt>
<dd>
<div class="desc"><p>Parse and run tasks.</p></div>
</dd>
</dl>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ds.pushd"><code class="name flex">
<span>def <span class="ident">pushd</span></span>(<span>dest:¬†Union[str,¬†Path]) ‚Äë>¬†Iterator[pathlib.Path]</span>
</code></dt>
<dd>
<div class="desc"><p>Temporarily change the current working directory.</p></div>
</dd>
<dt id="ds.load_config"><code class="name flex">
<span>def <span class="ident">load_config</span></span>(<span>args:¬†Args) ‚Äë>¬†<a title="ds.configs.Config" href="configs.html#ds.configs.Config">Config</a></span>
</code></dt>
<dd>
<div class="desc"><p>Load configuration file.</p></div>
</dd>
<dt id="ds.run_workspace"><code class="name flex">
<span>def <span class="ident">run_workspace</span></span>(<span>args:¬†Args, config:¬†Config) ‚Äë>¬†None</span>
</code></dt>
<dd>
<div class="desc"><p>Run tasks in the context of each member.</p></div>
</dd>
<dt id="ds.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>argv:¬†Optional[List[str]]¬†=¬†None) ‚Äë>¬†None</span>
</code></dt>
<dd>
<div class="desc"><p>Main entry point.</p></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul>
<li><a href="#example">Example</a></li>
<li><a href="#benefits">Benefits</a></li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#install">Install</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#when-should-i-make-a-dev-script">When should I make a dev script?</a></li>
<li><a href="#where-should-i-put-my-config">Where should I put my config?</a></li>
<li><a href="#how-does-ds-find-my-config">How does ds find my config?</a></li>
<li><a href="#where-do-tasks-run">Where do tasks run?</a></li>
<li><a href="#task-keys">Task Keys</a></li>
<li><a href="#task-names">Task Names</a></li>
<li><a href="#basic-task">Basic Task</a></li>
<li><a href="#composite-task">Composite Task</a></li>
<li><a href="#argument-interpolation">Argument Interpolation</a><ul>
<li><a href="#command-line-arguments">Command-line Arguments</a></li>
</ul>
</li>
<li><a href="#error-suppression">Error Suppression</a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
<li><a href="#workspaces">Workspaces</a><ul>
<li><a href="#workspace-members">Workspace Members</a></li>
<li><a href="#workspace-tasks">Workspace Tasks</a></li>
</ul>
</li>
<li><a href="#not-supported-lifecycle-events">Not Supported: Lifecycle Events</a></li>
<li><a href="#not-supported-call-tasks">Not Supported: call Tasks</a></li>
<li><a href="#inspirations">Inspirations</a></li>
<li><a href="#license">License</a></li>
</ul>
</div>
<ul id="index">
<li><h3><a href="#header-submodules">Sub-modules</a></h3>
<ul>
<li><code><a title="ds.args" href="args.html">ds.args</a></code></li>
<li><code><a title="ds.configs" href="configs.html">ds.configs</a></code></li>
<li><code><a title="ds.env" href="env.html">ds.env</a></code></li>
<li><code><a title="ds.parsers" href="parsers/index.html">ds.parsers</a></code></li>
<li><code><a title="ds.runner" href="runner.html">ds.runner</a></code></li>
<li><code><a title="ds.searchers" href="searchers.html">ds.searchers</a></code></li>
<li><code><a title="ds.symbols" href="symbols.html">ds.symbols</a></code></li>
<li><code><a title="ds.tasks" href="tasks.html">ds.tasks</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="ds.pushd" href="#ds.pushd">pushd</a></code></li>
<li><code><a title="ds.load_config" href="#ds.load_config">load_config</a></code></li>
<li><code><a title="ds.run_workspace" href="#ds.run_workspace">run_workspace</a></code></li>
<li><code><a title="ds.main" href="#ds.main">main</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.0</a>.</p>
</footer>
</body>
</html>
