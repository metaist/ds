<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.0">
<title>ds.tasks API documentation</title>
<meta name="description" content="Parse and run tasks.">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ds.tasks</code></h1>
</header>
<section id="section-intro">
<p>Parse and run tasks.</p>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-variables">Global variables</h2>
<dl>
<dt id="ds.tasks.Tasks"><code class="name">var <span class="ident">Tasks</span></code></dt>
<dd>
<div class="desc"><p>Mapping of task names to <code><a title="ds.tasks.Task" href="#ds.tasks.Task">Task</a></code> objects.</p></div>
</dd>
<dt id="ds.tasks.ORIGINAL_CWD"><code class="name">var <span class="ident">ORIGINAL_CWD</span></code></dt>
<dd>
<div class="desc"><p>Save a reference to the original working directory.</p></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="ds.tasks.check_cycles"><code class="name flex">
<span>def <span class="ident">check_cycles</span></span>(<span>tasks: <a title="ds.tasks.Tasks" href="#ds.tasks.Tasks">Tasks</a>) ‑> List[str]</span>
</code></dt>
<dd>
<div class="desc"><p>Raise a <code><a title="ds.tasks.CycleError" href="#ds.tasks.CycleError">CycleError</a></code> if there is a cycle in the task graph.</p></div>
</dd>
<dt id="ds.tasks.print_tasks"><code class="name flex">
<span>def <span class="ident">print_tasks</span></span>(<span>path: Path, tasks: <a title="ds.tasks.Tasks" href="#ds.tasks.Tasks">Tasks</a>) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Pretty print task names.</p></div>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ds.tasks.CycleError"><code class="flex name class">
<span>class <span class="ident">CycleError</span></span>
<span>(</span><span>*args, **kwargs)</span>
</code></dt>
<dd>
<div class="desc"><p>Subclass of ValueError raised by TopologicalSorter.prepare if cycles
exist in the working graph.</p>
<p>If multiple cycles exist, only one undefined choice among them will be reported
and included in the exception. The detected cycle can be accessed via the second
element in the <em>args</em> attribute of the exception instance and consists in a list
of nodes, such that each node is, in the graph, an immediate predecessor of the
next node in the list. In the reported list, the first and the last node will be
the same, to make it clear that it is cyclic.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class CycleError(ValueError):
    &#34;&#34;&#34;Subclass of ValueError raised by TopologicalSorter.prepare if cycles
    exist in the working graph.

    If multiple cycles exist, only one undefined choice among them will be reported
    and included in the exception. The detected cycle can be accessed via the second
    element in the *args* attribute of the exception instance and consists in a list
    of nodes, such that each node is, in the graph, an immediate predecessor of the
    next node in the list. In the reported list, the first and the last node will be
    the same, to make it clear that it is cyclic.
    &#34;&#34;&#34;

    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>builtins.ValueError</li>
<li>builtins.Exception</li>
<li>builtins.BaseException</li>
</ul>
</dd>
<dt id="ds.tasks.Task"><code class="flex name class">
<span>class <span class="ident">Task</span></span>
<span>(</span><span>origin: Optional[Path] = None, origin_key: str = '', name: str = '', help: str = '', verbatim: bool = False, depends: List[<a title="ds.tasks.Task" href="#ds.tasks.Task">Task</a>] = &lt;factory&gt;, cmd: str = '', code: int = 0, args: List[str] = &lt;factory&gt;, cwd: Optional[Path] = None, env: Dict[str, str] = &lt;factory&gt;, env_file: Optional[Path] = None, keep_going: bool = False)</span>
</code></dt>
<dd>
<div class="desc"><p>Represents a thing to be done.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclass
class Task:
    &#34;&#34;&#34;Represents a thing to be done.&#34;&#34;&#34;

    origin: Optional[Path] = None
    &#34;&#34;&#34;File from which this configuration came.&#34;&#34;&#34;

    origin_key: str = &#34;&#34;
    &#34;&#34;&#34;Key from which this task came.&#34;&#34;&#34;

    name: str = &#34;&#34;
    &#34;&#34;&#34;Task name.&#34;&#34;&#34;

    help: str = &#34;&#34;
    &#34;&#34;&#34;Task description.&#34;&#34;&#34;

    verbatim: bool = False
    &#34;&#34;&#34;Whether to format the command at all.&#34;&#34;&#34;

    depends: List[Task] = field(default_factory=list)
    &#34;&#34;&#34;Tasks to execute before this one.&#34;&#34;&#34;

    cmd: str = &#34;&#34;
    &#34;&#34;&#34;Shell command to execute after `depends`.&#34;&#34;&#34;

    code: int = 0
    &#34;&#34;&#34;Return code from running this task.&#34;&#34;&#34;

    # NOTE: args, cwd, env, keep_going are overridable
    # via the CLI or when calling a composite command.

    args: List[str] = field(default_factory=list)
    &#34;&#34;&#34;Additional arguments to `cmd`.&#34;&#34;&#34;

    cwd: Optional[Path] = None
    &#34;&#34;&#34;Task working directory.&#34;&#34;&#34;

    env: Dict[str, str] = field(default_factory=dict)
    &#34;&#34;&#34;Task environment variables.&#34;&#34;&#34;

    _env: Dict[str, str] = field(default_factory=dict)
    &#34;&#34;&#34;Hidden environment variables.&#34;&#34;&#34;

    env_file: Optional[Path] = None
    &#34;&#34;&#34;Path to an environment file to load.&#34;&#34;&#34;

    keep_going: bool = False
    &#34;&#34;&#34;Ignore a non-zero return code.&#34;&#34;&#34;

    def pprint(self, override: Optional[Task] = None, dry_run: bool = False) -&gt; None:
        &#34;&#34;&#34;Print a representation of this task.&#34;&#34;&#34;
        is_run = override or dry_run
        display = self
        if override:
            display = replace(self, cmd=override.cmd, keep_going=override.keep_going)

        print()

        if dry_run:
            print(&#34;[DRY RUN]&#34;)
        if display.help:
            print(&#34;#&#34;, display.help)
        print(&#34;&gt;&#34;, wrap_cmd(self.as_args(override)))

        if not is_run and display.depends:
            print(
                [
                    f&#34;{TASK_KEEP_GOING if t.keep_going else &#39;&#39;}{t.cmd}&#34;
                    for t in display.depends
                ]
            )

        if display.cmd:
            if display.verbatim:
                print(&#34;$&#34;, display.cmd.strip().replace(&#34;\n&#34;, &#34;\n$ &#34;))
            else:
                print(f&#34;$ {wrap_cmd(display.cmd)}&#34;)

    def as_args(self, override: Optional[Task] = None) -&gt; str:
        &#34;&#34;&#34;Return a shell representation of running this task.&#34;&#34;&#34;
        override = override or Task()

        args = [&#34;ds&#34;]
        if self.cwd:
            args.extend([&#34;--cwd&#34;, str(self.cwd)])
        if self.env_file:
            args.extend([&#34;--env-file&#34;, str(self.env_file)])
        for key, val in (self.env or {}).items():
            args.extend([&#34;-e&#34;, f&#34;{key}={val}&#34;])

        prefix = &#34;&#34;
        if self.keep_going or override.keep_going:
            prefix = TASK_KEEP_GOING
        if self.name == TASK_COMPOSITE:
            args.append(f&#34;{prefix}{self.cmd}&#34;)
        elif self.name:
            args.append(f&#34;{prefix}{self.name}&#34;)
        return join(args)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="ds.tasks.Task.depends"><code class="name">var <span class="ident">depends</span> : List[<a title="ds.tasks.Task" href="#ds.tasks.Task">Task</a>]</code></dt>
<dd>
<div class="desc"><p>Tasks to execute before this one.</p></div>
</dd>
<dt id="ds.tasks.Task.args"><code class="name">var <span class="ident">args</span> : List[str]</code></dt>
<dd>
<div class="desc"><p>Additional arguments to <code>cmd</code>.</p></div>
</dd>
<dt id="ds.tasks.Task.env"><code class="name">var <span class="ident">env</span> : Dict[str, str]</code></dt>
<dd>
<div class="desc"><p>Task environment variables.</p></div>
</dd>
<dt id="ds.tasks.Task.origin"><code class="name">var <span class="ident">origin</span> : Optional[pathlib.Path]</code></dt>
<dd>
<div class="desc"><p>File from which this configuration came.</p></div>
</dd>
<dt id="ds.tasks.Task.origin_key"><code class="name">var <span class="ident">origin_key</span> : str</code></dt>
<dd>
<div class="desc"><p>Key from which this task came.</p></div>
</dd>
<dt id="ds.tasks.Task.name"><code class="name">var <span class="ident">name</span> : str</code></dt>
<dd>
<div class="desc"><p>Task name.</p></div>
</dd>
<dt id="ds.tasks.Task.help"><code class="name">var <span class="ident">help</span> : str</code></dt>
<dd>
<div class="desc"><p>Task description.</p></div>
</dd>
<dt id="ds.tasks.Task.verbatim"><code class="name">var <span class="ident">verbatim</span> : bool</code></dt>
<dd>
<div class="desc"><p>Whether to format the command at all.</p></div>
</dd>
<dt id="ds.tasks.Task.cmd"><code class="name">var <span class="ident">cmd</span> : str</code></dt>
<dd>
<div class="desc"><p>Shell command to execute after <code>depends</code>.</p></div>
</dd>
<dt id="ds.tasks.Task.code"><code class="name">var <span class="ident">code</span> : int</code></dt>
<dd>
<div class="desc"><p>Return code from running this task.</p></div>
</dd>
<dt id="ds.tasks.Task.cwd"><code class="name">var <span class="ident">cwd</span> : Optional[pathlib.Path]</code></dt>
<dd>
<div class="desc"><p>Task working directory.</p></div>
</dd>
<dt id="ds.tasks.Task.env_file"><code class="name">var <span class="ident">env_file</span> : Optional[pathlib.Path]</code></dt>
<dd>
<div class="desc"><p>Path to an environment file to load.</p></div>
</dd>
<dt id="ds.tasks.Task.keep_going"><code class="name">var <span class="ident">keep_going</span> : bool</code></dt>
<dd>
<div class="desc"><p>Ignore a non-zero return code.</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="ds.tasks.Task.pprint"><code class="name flex">
<span>def <span class="ident">pprint</span></span>(<span>self, override: Optional[<a title="ds.tasks.Task" href="#ds.tasks.Task">Task</a>] = None, dry_run: bool = False) ‑> None</span>
</code></dt>
<dd>
<div class="desc"><p>Print a representation of this task.</p></div>
</dd>
<dt id="ds.tasks.Task.as_args"><code class="name flex">
<span>def <span class="ident">as_args</span></span>(<span>self, override: Optional[<a title="ds.tasks.Task" href="#ds.tasks.Task">Task</a>] = None) ‑> str</span>
</code></dt>
<dd>
<div class="desc"><p>Return a shell representation of running this task.</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ds" href="index.html">ds</a></code></li>
</ul>
</li>
<li><h3><a href="#header-variables">Global variables</a></h3>
<ul class="">
<li><code><a title="ds.tasks.Tasks" href="#ds.tasks.Tasks">Tasks</a></code></li>
<li><code><a title="ds.tasks.ORIGINAL_CWD" href="#ds.tasks.ORIGINAL_CWD">ORIGINAL_CWD</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="ds.tasks.check_cycles" href="#ds.tasks.check_cycles">check_cycles</a></code></li>
<li><code><a title="ds.tasks.print_tasks" href="#ds.tasks.print_tasks">print_tasks</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ds.tasks.CycleError" href="#ds.tasks.CycleError">CycleError</a></code></h4>
</li>
<li>
<h4><code><a title="ds.tasks.Task" href="#ds.tasks.Task">Task</a></code></h4>
<ul class="two-column">
<li><code><a title="ds.tasks.Task.pprint" href="#ds.tasks.Task.pprint">pprint</a></code></li>
<li><code><a title="ds.tasks.Task.as_args" href="#ds.tasks.Task.as_args">as_args</a></code></li>
<li><code><a title="ds.tasks.Task.depends" href="#ds.tasks.Task.depends">depends</a></code></li>
<li><code><a title="ds.tasks.Task.args" href="#ds.tasks.Task.args">args</a></code></li>
<li><code><a title="ds.tasks.Task.env" href="#ds.tasks.Task.env">env</a></code></li>
<li><code><a title="ds.tasks.Task.origin" href="#ds.tasks.Task.origin">origin</a></code></li>
<li><code><a title="ds.tasks.Task.origin_key" href="#ds.tasks.Task.origin_key">origin_key</a></code></li>
<li><code><a title="ds.tasks.Task.name" href="#ds.tasks.Task.name">name</a></code></li>
<li><code><a title="ds.tasks.Task.help" href="#ds.tasks.Task.help">help</a></code></li>
<li><code><a title="ds.tasks.Task.verbatim" href="#ds.tasks.Task.verbatim">verbatim</a></code></li>
<li><code><a title="ds.tasks.Task.cmd" href="#ds.tasks.Task.cmd">cmd</a></code></li>
<li><code><a title="ds.tasks.Task.code" href="#ds.tasks.Task.code">code</a></code></li>
<li><code><a title="ds.tasks.Task.cwd" href="#ds.tasks.Task.cwd">cwd</a></code></li>
<li><code><a title="ds.tasks.Task.env_file" href="#ds.tasks.Task.env_file">env_file</a></code></li>
<li><code><a title="ds.tasks.Task.keep_going" href="#ds.tasks.Task.keep_going">keep_going</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.0</a>.</p>
</footer>
</body>
</html>
